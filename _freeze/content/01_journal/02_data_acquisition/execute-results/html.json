{
  "hash": "4a7c45e79a5d492a98cd775984848c34",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Omar Hegazy\"\nMatriculation number: \"568463\"\n---\n\n# Challenge: \n## Get some data via an API.\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_b6df55a94c7ca5a848df804cd72b82b9'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ninstall.packages(\"devtools\", repos = \"http://cran.rstudio.com/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> package 'devtools' successfully unpacked and MD5 sums checked\n#> \n#> The downloaded binary packages are in\n#> \tC:\\Users\\Micro Systems\\AppData\\Local\\Temp\\Rtmps75Inc\\downloaded_packages\n```\n:::\n\n```{.r .cell-code}\n  library(tidyverse) \nlibrary(jsonlite)  \nlibrary(glue)      \nlibrary(httr)\nlibrary(data.table)\n\n\n\n\nweather_url <- \"http://api.weatherapi.com/v1/current.json?/\"\ncity<-\"Hamburg\"\ntoken <- \"cc1ebbea233a4bf0a3e81547210805\"\nresponse <-GET(weather_url, query = list(\n  key  = token,\n  q    = city))\nresponse\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Response [http://api.weatherapi.com/v1/current.json?%2F=&key=cc1ebbea233a4bf0a3e81547210805&q=Hamburg]\n#>   Date: 2023-05-23 23:02\n#>   Status: 200\n#>   Content-Type: application/json\n#>   Size: 666 B\n```\n:::\n\n```{.r .cell-code}\nbetter_format <-response %>% \n  .$content %>%\n  rawToChar() %>% \n  fromJSON()\ndata_frame1<-as.data.frame(better_format)\ndata_frame1\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"location.name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"location.region\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"location.country\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"location.lat\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"location.lon\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"location.tz_id\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"location.localtime_epoch\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"location.localtime\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"current.last_updated_epoch\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"current.last_updated\"],\"name\":[10],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"current.temp_c\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.temp_f\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.is_day\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"current.condition.text\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"current.condition.icon\"],\"name\":[15],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"current.condition.code\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"current.wind_mph\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.wind_kph\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.wind_degree\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"current.wind_dir\"],\"name\":[20],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"current.pressure_mb\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.pressure_in\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.precip_mm\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.precip_in\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.humidity\"],\"name\":[25],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"current.cloud\"],\"name\":[26],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"current.feelslike_c\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.feelslike_f\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.vis_km\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.vis_miles\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.uv\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.gust_mph\"],\"name\":[32],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"current.gust_kph\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Hamburg\",\"2\":\"Hamburg\",\"3\":\"Germany\",\"4\":\"53.55\",\"5\":\"10\",\"6\":\"Europe/Berlin\",\"7\":\"1684882942\",\"8\":\"2023-05-24 1:02\",\"9\":\"1684882800\",\"10\":\"2023-05-24 01:00\",\"11\":\"9\",\"12\":\"48.2\",\"13\":\"0\",\"14\":\"Overcast\",\"15\":\"//cdn.weatherapi.com/weather/64x64/night/122.png\",\"16\":\"1009\",\"17\":\"11.9\",\"18\":\"19.1\",\"19\":\"280\",\"20\":\"W\",\"21\":\"1020\",\"22\":\"30.12\",\"23\":\"0\",\"24\":\"0\",\"25\":\"76\",\"26\":\"100\",\"27\":\"6.3\",\"28\":\"43.3\",\"29\":\"10\",\"30\":\"6\",\"31\":\"1\",\"32\":\"17\",\"33\":\"27.4\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n# Challenge: \n## Scrape one of the competitor websites of canyon\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_aa08ade2822a3a54e4232c2401fdcc25'}\n\n```{.r .cell-code}\nlibrary(RSQLite)\nlibrary(tidyverse)\nlibrary(httr)\nlibrary(glue)\nlibrary(jsonlite)\nlibrary(rvest)\nlibrary(stringi)\nlibrary(xopen)\nlibrary(dplyr)\nbase_url <- 'https://www.rosebikes.com/bikes'\n# 1. Function getting bike family URLs.\nget_bike_family_urls <- function(base_url) {\n  \n  bike_family_urls <- read_html(base_url) %>%\n    html_nodes(css = \".catalog-categories-item > a\") %>%\n    html_attr('href') %>%\n    \n    # tibble formatting\n    \n    enframe(name = \"position\", value = \"subdirectory\") %>%\n    # Adding the domain because we only got the subdirectories\n    mutate(\n      url = glue('https://www.rosebikes.com{subdirectory}')\n    ) \n  \n}\n# 2.function to get bike type URLs.\nget_model_urls <- function(url) {\n  \n  bike_type_url <- read_html(url) %>%\n    html_nodes(css = \".catalog-category-bikes__content > a\") %>%\n    html_attr('href') %>%\n    enframe(name = \"position\", value = \"url\") %>%\n    mutate(url = glue('https://www.rosebikes.com{url}')) \n}\n# 3. name of each bike \nget_bike_names <- function(url) {\n  \n  bike_model_name_tbl <- read_html(url) %>%\n    html_nodes(css = \".catalog-category-model__title\") %>%\n    html_text() %>%\n    # tibble formatting\n    as_tibble()\n  \n  \n}\n# 4. the prices of each bike \nget_bike_prices <- function(url) {\n  \n  bike_model_price_tbl <- read_html(url) %>%\n    html_nodes(css = \".product-tile-price__current-value\") %>%\n    html_text() %>%\n    # tibble formatting\n    as_tibble()\n  \n}\n#### combining functions in a row to execute code\nbike_family_url_tbl <- get_bike_family_urls(base_url)\nbike_family_url_tbl <- bike_family_url_tbl %>%\n  slice(3:6) # Pick 3 categories\n# table with bike model URLS\nbike_model_url_tbl <- tibble()\nfor (i in seq_along(bike_family_url_tbl$url)) {\n  \n  web <- toString(bike_family_url_tbl$url[i])\n  bike_model_url_tbl <- bind_rows(bike_model_url_tbl, get_model_urls(web))\n  \n}\n# table with bike model names\nbike_model_names_tbl <- tibble()\nfor (i in seq_along(bike_model_url_tbl$url)) {\n  \n  web <- toString(bike_model_url_tbl$url[i])\n  bike_model_names_tbl <- bind_rows(bike_model_names_tbl, get_bike_names(web))\n  \n}\n# Renaming of columns\nnames(bike_model_names_tbl)[1] <- \"Bike Model\"\n# table with bike prices\nbike_model_prices_tbl <- tibble()\nfor (i in seq_along(bike_model_url_tbl$url)) {\n  web <- toString(bike_model_url_tbl$url[i])\n  bike_model_prices_tbl <- bind_rows(bike_model_prices_tbl, get_bike_prices(web))\n}\n# renaming of columns\nnames(bike_model_prices_tbl)[1] <- \"Bike Prices\"\n# combining columns in one table\ntable_of_prices <- bind_cols(bike_model_names_tbl,bike_model_prices_tbl)\nknitr::kable(table_of_prices[1:10, ], caption = 'Rosebike.com bicycle prices')\n```\n\n::: {.cell-output-display}\nTable: Rosebike.com bicycle prices\n\n|Bike Model                    |Bike Prices |\n|:-----------------------------|:-----------|\n|BACKROAD AL Apex 1x11         |€2,049.00   |\n|BACKROAD AL GRX RX600 1X11    |€2,349.00   |\n|BACKROAD AL GRX RX810 1X11    |€2,549.00   |\n|BACKROAD AL GRX RX400         |€1,999.00   |\n|BACKROAD AL GRX RX400         |€1,999.00   |\n|BACKROAD AL GRX RX600         |€2,399.00   |\n|BACKROAD AL GRX RX810         |€2,599.00   |\n|BACKROAD AL GRX600 RANDONNEUR |€2,499.00   |\n|BACKROAD AL GRX RX400         |€1,999.00   |\n|BACKROAD AL GRX RX400         |€1,999.00   |\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}